{% extends "base.html" %}

{% block title %}ElectroDoc - Statistiques{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="row mb-4">
  <div class="col-12">
    <div class="card">
      <div class="card-body text-center">
        <h1 class="card-title mb-3">
          <i class="fas fa-chart-bar text-primary"></i>
          Tableau de Bord - Statistiques
        </h1>
        <p class="card-text text-muted">Vue d'ensemble de vos données</p>
      </div>
    </div>
  </div>
</div>

<!-- Statistics Cards -->
<div class="row mb-4">
  <div class="col-md-3">
    <div class="card stats-card">
      <div class="card-body text-center">
        <i class="fas fa-folder fa-2x mb-2"></i>
        <h4 class="card-title">{{ total_documents }}</h4>
        <p class="card-text">Documents Totaux</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card">
      <div class="card-body text-center">
        <i class="fas fa-boxes fa-2x mb-2"></i>
        <h4 class="card-title">{{ documents_by_dossier|length }}</h4>
        <p class="card-text">Dossiers Uniques</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card">
      <div class="card-body text-center">
        <i class="fas fa-microchip fa-2x mb-2"></i>
        <h4 class="card-title">{{ total_states }}</h4>
        <p class="card-text">États Totaux</p>
      </div>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card stats-card">
      <div class="card-body text-center">
        <i class="fas fa-chart-line fa-2x mb-2"></i>
        <h4 class="card-title">
          {{ "%.1f"|format(total_documents / documents_by_dossier|length if documents_by_dossier|length > 0 else 0) }}
        </h4>
        <p class="card-text">Moyenne par Dossier</p>
      </div>
    </div>
  </div>
</div>

<!-- Charts and Details -->
<div class="row">
  <!-- Documents by Dossier -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-folder-open"></i> Documents par Dossier
        </h5>
      </div>
      <div class="card-body">
        {% if documents_by_dossier %}
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Dossier</th>
                <th>Nombre de Documents</th>
                <th>Pourcentage</th>
              </tr>
            </thead>
            <tbody>
              {% for dossier, count in documents_by_dossier %}
              <tr>
                <td><span class="badge bg-primary">{{ dossier }}</span></td>
                <td>{{ count }}</td>
                <td>
                  {% set percent = (count / total_documents * 100) if total_documents > 0 else 0 %}
                  {{ percent|round(1, 'floor') }}%
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        {% else %}
        <div class="text-center py-4">
          <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
          <h6 class="text-muted">Aucune donnée disponible</h6>
        </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="col-md-6">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-bolt"></i> Actions Rapides
        </h5>
      </div>
      <div class="card-body">
        <div class="d-grid gap-3">
          <a href="{{ url_for('add_document') }}" class="btn btn-success">
            <i class="fas fa-plus"></i> Ajouter un Document
          </a>
          <a href="{{ url_for('dashboard') }}" class="btn btn-primary">
            <i class="fas fa-list"></i> Voir tous les Documents
          </a>
          <a href="{{ url_for('tables') }}" class="btn btn-info">
            <i class="fas fa-database"></i> Structure de la Base
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Additional Statistics -->
<div class="row mt-4">
  <div class="col-12">
    <div class="card">
      <div class="card-header">
        <h5 class="card-title mb-0">
          <i class="fas fa-info-circle"></i> Informations Système
        </h5>
      </div>
      <div class="card-body">
        <div class="row">
          <div class="col-md-4">
            <div class="text-center">
              <i class="fas fa-database fa-2x text-primary mb-2"></i>
              <h6>Base de Données</h6>
              <p class="text-muted">SQLite</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-center">
              <i class="fas fa-code fa-2x text-success mb-2"></i>
              <h6>Framework</h6>
              <p class="text-muted">Flask</p>
            </div>
          </div>
          <div class="col-md-4">
            <div class="text-center">
              <i class="fas fa-server fa-2x text-warning mb-2"></i>
              <h6>Serveur</h6>
              <p class="text-muted">Développement</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
